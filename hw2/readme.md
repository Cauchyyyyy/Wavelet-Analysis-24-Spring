#   基于小波变换的图像处理

##  算法原理
### Arnold 变换
Arnold变换

$$
    \begin{pmatrix}
    x'\\
    y'
    \end{pmatrix}
    =
    \begin{pmatrix}
    1&b\\
    a&ab+1
    \end{pmatrix}
    \begin{pmatrix}
    x\\
    y
    \end{pmatrix}
    mod(N)
$$

Arnold逆变换
$$
    \begin{pmatrix}
    x'\\
    y'
    \end{pmatrix}
    =
    \begin{pmatrix}
    ab+1&-b\\
    -a&1
    \end{pmatrix}
    \begin{pmatrix}
    x\\
    y
    \end{pmatrix}
    mod(N)
$$
##  算法流程
### 水印嵌入
待加入水印的图像为$im$,水印为$wm$.
1. 对图像进行2层离散小波变换，每层的分解得到低频、水平、垂直、对角线部分，
    分别记为$ca1,cd1,ch1,cv1$，
对低频部分$ca1$进行下一层的分解，记为$ca2,cd2,ch2,cv2$.

2. 将水印嵌入到低频部分$ca2$中.

先对水印图像做Arnold变换，得到新的水印图像$wm'$.

Arnold变换的重要特征是其具有周期性，图像变换一定次数后可以恢复到变换前图像的状态.
由于嵌入了水印的数字图像在传输和保存等过程中可能出现损坏或信息丢失等情况，嵌入其中的
水印图像也会发生损坏或信息丢失等情况.利用Arnold变换的周期性特征，通过对水印图像进行
多次Arnold变换，可以将损坏的水印信息平均分配到整个水印图像中，减少损失信息对人眼视觉感受的影响.

对$ca2,wm'$进行奇异值分解，得到
$$ca2=u1\times s1\times v1^T,wm=u2\times s2\times v2^T$$


利用加性原则，将进行幅度调整后的水印奇异值矩阵$s2$添加到图像奇异值矩阵$s1$中，得到水印嵌入结果幅度调整比例为$\alpha$，表达式为
$$s1' = s1 + \alpha \times s2$$
    
最后将$u1,s1',v1^T$相乘得到新的低频部分$ca2'$.利用2次小波逆变换，将$ca2',cd2,ch2,cv2$等合并得到添加水印后的图像$im'$.

### 水印提取
将上述过程反向操作，在已知水印图像、原始图像的情况下，可以提取出嵌入在图像中的水印.

##  质量评估
为了定量表征水印的可见性，采用峰值功率信噪比(PSNR)作为该指标的度量.峰值功率信噪比定义为原始图像和嵌入水印后图像在各个像素点的灰度差值的函数，该值越大说明水印的效果越好，其表达式为
$$ PSNR = 10 \times \log_{10}(\frac{255^2}{MSE})$$

其中MSE为均方误差。

在db4小波下，嵌入水印后的图像和原始图像的PSNR值为$27.9420$.


从嵌入水印后的图像以及上述4种噪声影响下的图像中，提取水印的PSNR值分别为
$$[20.9,14.9,13.0,19.9,11.7]$$

##  Reference
[1] 刘琰,周理.基于小波变换域的数字图像嵌入和提取方法[J].沈阳工业大学学报,2019,41(01):68-72.